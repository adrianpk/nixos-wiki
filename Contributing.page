How to write a patch ?
----------------------

quick & dirty: copy paste existing code and make it fit your needs.

Additionally you should read various docs:

(TODO complete this list and put in proper urls to the final document
rather than the xml sources)

Source:

-   NIXPKGS\_REPO/maintainers/\*
-   NIXPKGS\_REPO/doc/\*

Eg doc/coding-conventions.xml

I have a patch
--------------

Thanks. Send it to the mailinglist so that we can discuss and apply it,
or open a pull request on github.

If your change breaks things don't scream if someone reverts it. It
happens. The best thing to do is to fix your patch. Try to check first
if it will cause a lot of rebuilds and add a note to your pull request
if you have already tested everything.

How to verify that you didn't break a dependency or the evaluation by accident ?
--------------------------------------------------------------------------------

To find out which packages are effected by your change:

    $ nix-env -f . -qaP \* --drv-path | sort > l1
    (...modify package...)
    $ nix-env -f . -qaP \* --drv-path | sort > l2
    $ changed=$(diff l1 l2 | awk '{print $2}' | sort | uniq)

    # This list can be used to create a release.nix for testing you can build all the relevant packages
    $ nix-build $(for i in $changed; do echo -A $i; done)

    #!/bin/sh
    set -e -x

    export NIXOS=${NIXOS:-/etc/nixos/nixos}
    export NIXPKGS_ALL=${NIXPKGS_ALL:-/etc/nixos/nixpkgs}

    # evaluate all derivations found in all-packages.nix:
    nix-env -qa '*' --show-trace -P --out-path -f $NIXPKGS_ALL/pkgs/top-level/all-packages.nix

    # evaluate all derivations found in release.nix before starting the build:
    # nix-env -qa '*' $NIXPKGS_ALL/pkgs/top-level/release.nix
    # nix-instantiate --readonly-mode $NIXPKGS_ALL/pkgs/top-level/release.nix --show-trace

    # build a release tarball which contains the most important packages (?)
    nix-build -A tarball $NIXOS/release.nix --show-trace

TODO: explain what is done exactly

 The nixpkgs-dev-utilities referenced on [Nix(OS) related repositories
and work](//Nix(OS) related repositories and work) tries to implement
this for your convinience

